/**
  * otho.js v0.1.0
  * Created by Louie Colgan (@ljbc1994)
  * Released under the MIT License.
  */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Otho=e()}}(function(){return function e(t,i,n){function r(a,s){if(!i[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[a]={exports:{}};t[a][0].call(c.exports,function(e){var i=t[a][1][e];return r(i?i:e)},c,c.exports,e,t,i,n)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=e("../utils/is-array"),s=n(a),u=function(){function e(t){var i=t.src,n=t.loaded,o=t.failed;r(this,e),this.src=i,this.pseudo=new Image,this._loaded=n||function(){},this._failed=o||function(){},this.init()}return o(e,null,[{key:"wait",value:function(t,i){(0,s.default)(t)||(t=[t]);for(var n=t.length,r=function(){n--,0===n&&i()},o=0;o<t.length;o++)new e({src:t[o],loaded:r.bind(this),failed:r.bind(this)})}}]),o(e,[{key:"init",value:function(){var e=this;e.pseudo.src=this.src,e.pseudo.addEventListener("load",this._loaded),e.pseudo.addEventListener("error",this._failed)}}]),e}();i.default=u},{"../utils/is-array":10}],2:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("./watcher"),u=n(s),l=e("./deferred-image"),c=n(l),d=e("../config/options"),f=e("../utils/is-array"),h=n(f),g=e("../utils/is-function"),y=n(g),m=e("../utils/is-node-list"),p=n(m),v=e("../utils/extend"),b=n(v),_=e("../utils/flatten"),w=n(_),k=function(){function e(t){var i=t.els,n=t.error,a=t.placehold,s=t.forcePlacehold,u=t.imageLoaded,l=t.imageLoading,c=t.sync,f=t.inView,h=t.background,g=t.success,y=t.fail,m=t.progress,p=t.loaded;r(this,e),this.els=this._getElements(i),this.watchers=[],this.error=n,this.placehold=a,this.inView=f,this.background=h,this.forcePlacehold=s,this.imageLoaded=u,this.imageLoading=l,this.fail=y||function(){},this.loaded=p||function(){},this.success=g||function(){},this.progress=m||function(){},"object"===("undefined"==typeof c?"undefined":o(c))&&(this.sync=(0,b.default)(d.syncOptions,c))}return a(e,[{key:"_getElements",value:function(e){return(0,h.default)(e)?e:(0,y.default)(e)?e.call(this):(0,p.default)(e)?Array.prototype.slice.call(e,0):[e]}},{key:"init",value:function(){return this._attachWatchers(),this.forcePlacehold&&(this.placehold||this.error)?c.default.wait([this.error,this.placehold],this._initWatchers.bind(this)):this.sync?(0,h.default)(this.sync.matrix)||(0,y.default)(this.sync.matrix)?this._initMatrix():this._syncWatchers(this.watchers):this._initWatchers()}},{key:"_attachWatchers",value:function(){for(var e=this,t=0;t<e.els.length;t++){var i=new u.default({el:e.els[t],error:e.error,placehold:e.placehold,imageLoaded:e.imageLoaded,imageLoading:e.imageLoading,background:e.background,loaded:e._imageLoaded.bind(e),failed:e._imageFailed.bind(e),success:e._imagesSuccess.bind(e)});e.watchers.push(i)}}},{key:"_initWatchers",value:function(){var e=this;return this.watchers.map(function(t){return e.inView?t.watchView():t.init()})}},{key:"_initMatrix",value:function(){if((0,y.default)(this.sync.matrix)&&(this.sync.matrix=this.sync.matrix(this.watchers)),this.watchers.length!==this.sync.matrix.length)throw new Error("The matrix must contain the same number of items as the number of images");var e=this,t={},i=[];return e.sync.matrix.forEach(function(i,n){(0,h.default)(t[i])?t[i].push(e.watchers[n]):t[i]=[e.watchers[n]]}),Object.keys(t).sort(function(e,t){return e-t}).forEach(function(e,n){i[n]=t[e]}),this._syncWatchers(i)}},{key:"_syncWatchers",value:function(e){var t=this,i=t.sync,n=i.delay,r=i.perLoad,o=0,a=Math.ceil(e.length/r),s=function t(){if(o++,o<=a){var i=r*(o-1),s=r*o,l=(0,w.default)(e.slice(i,s));u.default.queue(l,setTimeout.bind(null,t,n))}};return t.watchers.map(function(e){return e._setup()}),s()}},{key:"_imageLoaded",value:function(e){var t=this,i=t.watchers.length,n=t.watchers.filter(function(e){return e.hasLoaded}).length;t.loaded(e),t.progress(e,{total:i,loaded:n,percent:Math.round(n/i*100)}),i===n&&t._imagesSuccess()}},{key:"_imageFailed",value:function(e){var t=this;t.fail(e),t._watchUpdates()}},{key:"_imagesSuccess",value:function(){var e=this;e.success(e.watchers),e._watchUpdates()}},{key:"_watchUpdates",value:function(){var e=this;window.addEventListener("resize",function(){e.watchers.filter(function(e){return e.hasBackground&&e.hasChanged()}).forEach(function(e){return e.updateBackground()})})}},{key:"update",value:function(){this.watchers.filter(function(e){return e.toLoad!==e.img.src&&!e.hasBackground}).forEach(function(e){return e.init()})}}]),e}();i.default=k},{"../config/options":4,"../utils/extend":7,"../utils/flatten":8,"../utils/is-array":10,"../utils/is-function":11,"../utils/is-node-list":13,"./deferred-image":1,"./watcher":3}],3:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=e("./deferred-image"),s=n(a),u=e("../utils/is-array"),l=n(u),c=e("../utils/is-image"),d=n(c),f=e("../utils/in-view"),h=n(f),g=e("../utils/dom-traversal"),y=e("../utils/style-manipulation"),m=function(){function e(t){var i=t.el,n=t.error,o=t.placehold,a=t.loaded,s=t.failed,u=t.imageLoaded,l=t.imageLoading,c=t.background;r(this,e),this.el=i,this.error=this.el.getAttribute("data-o-error")||n,this.background=this.el.getAttribute("data-o-background")||c,this.placehold=this.el.getAttribute("data-o-placehold")||o,this.imageLoaded=this.el.getAttribute("data-o-loaded")||u,this.imageLoading=this.el.getAttribute("data-o-loading")||l,this.loaded=a,this.failed=s}return o(e,null,[{key:"queue",value:function(e,t){(0,l.default)(e)||(e=[e]);for(var i=e.length,n=function(){i--,0===i&&t()},r=0;r<e.length;r++){var o=e[r];o._any=n.bind(this),o.init(!0)}}}]),o(e,[{key:"init",value:function(e){return e||this._setup(),(0,y.addClass)(this.el,this.imageLoading),this.pseudo=new s.default({src:this.toLoad,loaded:this._loaded.bind(this),failed:this._error.bind(this)}),this}},{key:"_setup",value:function(){this.pseudo={},this.inView=!1,this.hasLoaded=!1,this.hasBackground=!1,this._getElement(this.el),this.toLoad=this._getImage(),this._setImage(this.placehold),(0,y.removeClass)(this.el,this.imageLoaded,this.imageLoading)}},{key:"watchView",value:function(){return this._setup(),window.addEventListener("scroll",this._onViewChange.bind(this)),window.addEventListener("resize",this._onViewChange.bind(this)),this._onViewChange()}},{key:"hasChanged",value:function(){return this.toLoad!==(0,y.getBackgroundImage)(this.img)}},{key:"_onViewChange",value:function(){(0,h.default)(this.el)&&!this.inView&&(window.removeEventListener("scroll",this._onViewChange.bind(this)),window.removeEventListener("resize",this._onViewChange.bind(this)),this.init(!0),this.inView=!0)}},{key:"_getElement",value:function(e){this.img=(0,d.default)(e)||this.background?e:(0,g.findClosestImage)(e)}},{key:"_setImage",value:function(e){this.background?(0,y.setBackgroundImage)(this.img,e):this.img.src=e}},{key:"_getImage",value:function(){return this.background?(0,y.getBackgroundImage)(this.img):this.img.getAttribute("data-o-src")}},{key:"_loaded",value:function(){(0,y.removeClass)(this.el,this.imageLoading),(0,y.addClass)(this.el,this.imageLoaded),this._setImage(this.toLoad),this.hasLoaded=!0,this.loaded(this),this._any(this)}},{key:"_error",value:function(){(0,y.removeClass)(this.el,this.imageLoading),this._setImage(this.error),this.hasLoaded=!0,this.failed(this),this._any(this)}},{key:"_any",value:function(){return this}}]),e}();i.default=m},{"../utils/dom-traversal":6,"../utils/in-view":9,"../utils/is-array":10,"../utils/is-image":12,"../utils/style-manipulation":14,"./deferred-image":1}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n={els:document.getElementsByTagName("img"),error:"",placehold:"",forcePlacehold:!1,inView:!1,background:!1,sync:!1,imageLoaded:"o-image-loaded",imageLoading:"o-image-loading"},r={perLoad:1,delay:0};i.defaultOptions=n,i.syncOptions=r},{}],5:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=(0,f.default)(a.defaultOptions,e);return new u.default(t).init()}function o(e,t){return c.default.wait(e,t)}Object.defineProperty(i,"__esModule",{value:!0}),i.load=r,i.preload=o;var a=e("./config/options"),s=e("./components/handler"),u=n(s),l=e("./components/deferred-image"),c=n(l),d=e("./utils/extend"),f=n(d)},{"./components/deferred-image":1,"./components/handler":2,"./config/options":4,"./utils/extend":7}],6:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=[];return function e(i){return(0,s.default)(i)?t.push(i):Array.prototype.slice.apply(i.childNodes).forEach(e)}(e),t}function o(e){var t=r(e);return t.length?t[0]:null}Object.defineProperty(i,"__esModule",{value:!0}),i.findClosestImage=i.findChildrenImages=void 0;var a=e("./is-image"),s=n(a);i.findChildrenImages=r,i.findClosestImage=o},{"./is-image":12}],7:[function(e,t,i){"use strict";function n(){var e={},t=!1,i=0,r=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],i++);for(var o=function(i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t&&"[object Object]"===Object.prototype.toString.call(i[r])?e[r]=n(!0,e[r],i[r]):e[r]=i[r])};i<r;i++)o(arguments[i]);return e}Object.defineProperty(i,"__esModule",{value:!0}),i.default=n},{}],8:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e){return(0,a.default)(e)?e.reduce(function(e,t){return e.concat((0,a.default)(t)?r(t):t)},[]):e}Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;var o=e("./is-array"),a=n(o)},{"./is-array":10}],9:[function(e,t,i){"use strict";function n(e){var t=e.getBoundingClientRect(),i=document.documentElement;return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||i.clientHeight)&&t.right<=(window.innerWidth||i.clientWidth)}Object.defineProperty(i,"__esModule",{value:!0}),i.default=n},{}],10:[function(e,t,i){"use strict";function n(e){return"[object Array]"===Object.prototype.toString.call(e)}Object.defineProperty(i,"__esModule",{value:!0}),i.default=n},{}],11:[function(e,t,i){"use strict";function n(e){return!!(e&&e.constructor&&e.call&&e.apply)}Object.defineProperty(i,"__esModule",{value:!0}),i.default=n},{}],12:[function(e,t,i){"use strict";function n(e){return"img"===e.nodeName.toLowerCase()}Object.defineProperty(i,"__esModule",{value:!0}),i.default=n},{}],13:[function(e,t,i){"use strict";function n(e){var t=Object.prototype.toString.call(e);return"object"===("undefined"==typeof e?"undefined":r(e))&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(t)&&"number"==typeof e.length&&(0===e.length||"object"===r(e[0])&&e[0].nodeType>0)}Object.defineProperty(i,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i.default=n},{}],14:[function(e,t,i){"use strict";function n(e){var t=Array.prototype.slice.call(arguments,1),i=e.className.split(" ");if(0===t.length)throw new Error("You need to provide at least one class");e.className=i.concat(t).join(" ").trim()}function r(e){var t=Array.prototype.slice.call(arguments,1);if(0===t.length)throw new Error("You need to provide at least one class");e.className=e.className.split(" ").filter(function(e){return t.indexOf(e)===-1}).join(" ").trim()}function o(e){var t=window.getComputedStyle(e,null).getPropertyValue("background"),i=t.indexOf("url(")+4,n=t.slice(i).indexOf(")");return t.slice(i).slice(0,n).replace(/["|']/g,"")}function a(e,t){e.style.backgroundImage="url("+t+")"}Object.defineProperty(i,"__esModule",{value:!0}),i.addClass=n,i.removeClass=r,i.getBackgroundImage=o,i.setBackgroundImage=a},{}]},{},[5])(5)});
